.. _kotlin-whats-new:

==========
What's New
==========

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Learn what's new in:

* :ref:`Version 4.10 <version-4.10>`

.. _upcoming-breaking-changes:

Upcoming Breaking Changes
-------------------------

- Beginning with v5.0, the Kotlin Driver requires Java 11 or later.
- Beginning with v5.0, several Stream API methods and classes will be
  removed. To learn which methods will be removed, see :ref:`version-4.11`.

.. _version-4.11:

What's New in 4.11
------------------

This section includes the following information:

- :ref:`kotlin-deprecations-4.11`
- :ref:`kotlin-new-features-4.11`

.. _kotlin-deprecations-4.11:

Deprecations in 4.11
~~~~~~~~~~~~~~~~~~~~

.. warning:: Deprecations in this release

   This version of the driver deprecates classes and methods.
   To avoid breaking changes in future major releases of the driver,
   replace any application code that depends on the deprecated code.

The 4.11 driver release deprecates the following items:

- The following network address-related methods are deprecated (TODO: replace this item with content from https://github.com/mongodb/docs-java/pull/446/files)

- The following Stream API methods and classes are deprecated and are
  scheduled for removal in v5.0:

  - ``streamFactoryFactory()`` method from ``MongoClientSettings.Builder``
  - ``getStreamFactoryFactory()`` method from ``MongoClientSettings``
  - ``NettyStreamFactoryFactory`` class
  - ``NettyStreamFactory`` class
  - ``AsynchronousSocketChannelStreamFactory`` class
  - ``AsynchronousSocketChannelStreamFactoryFactory`` class
  - ``BufferProvider`` class
  - ``SocketStreamFactory`` class
  - ``Stream`` class
  - ``StreamFactory`` class
  - ``StreamFactoryFactory`` class
  - ``TlsChannelStreamFactoryFactory`` class

  If you configure Netty by using
  ``streamFactoryFactory()``, ``getStreamFactoryFactory()``, or ``NettyStreamFactoryFactory``,
  replace your code with the `TransportSettings.nettyBuilder() <{+api+}/apidocs/mongodb-driver-core/com/mongodb/connection/TransportSettings.html>`__
  in the nondeprecated API as shown in the following example:

  .. code-block:: kotlin
     :emphasize-lines: 6

     import com.mongodb.connection.TransportSettings;

     // ...

     val settings = MongoClientSettings.builder()
         .transportSettings(TransportSettings.nettyBuilder().build())
         .build()

  No replacements are planned for the rest of the Stream API classes.

.. _kotlin-new-features-4.11:

New Features in 4.11
~~~~~~~~~~~~~~~~~~~~

New features of the 4.11 driver release include:

- Support for connecting to MongoDB by using a SOCKS5 proxy.
- Added the ``getSplitEvent()`` method to the ``ChangeStreamDocument`` class
  to identify fragments of a change stream event that exceeds 16MB. You must
  use the aggregation stage ``$changeStreamSplitLargeEvent`` in your change
  stream to handle events that exceed 16MB. 
- Added an aggregation stage builder for ``$vectorSearch``.
- Added search index management helpers.
- Updated Snappy and Zstd compression library dependency versions. To learn
  more about the current dependency versions, see :ref:`network-compression`.
- Added ``getElapsedTime()`` methods to the following classes to monitor the
  duration of connection pool events:

  - `ConnectionCheckOutFailedEvent <{+api+}/apidocs/mongodb-driver-core/com/mongodb/event/ConnectionCheckOutFailedEvent.html>`__
  - `ConnectionCheckedOutEvent <{+api+}/apidocs/mongodb-driver-core/com/mongodb/event/ConnectionCheckedOutEvent.html>`__
  - `ConnectionReadyEvent <{+api+}/apidocs/mongodb-driver-core/com/mongodb/event/ConnectionReadyEvent.html>`__

.. _version-4.10:

What's New in 4.10
------------------

.. important::

   Starting in version 4.10.1 of the {+driver-short+}, you must add
   the ``bson-kotlinx`` library as an explicit dependency to use the
   ``kotlinx-serialization`` library.

- Support for Kotlin server-side usage, both for coroutines and for synchronous applications.
- Codec support for Kotlin data classes.
- Support for the ``kotlinx.serialization`` library
